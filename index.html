<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3D 擲筊模擬器</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; }
    canvas { display: block; }
    #info {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #fff;
      font-family: sans-serif;
      z-index: 10;
    }
    button {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      font-size: 18px;
      background: #b22222;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }
  </style>
</head>
<body>
  <div id="info">3D 擲筊模擬器</div>
  <button onclick="throwCups()">擲筊</button>
  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.150.1';
    import { OrbitControls } from 'https://cdn.skypack.dev/three/examples/jsm/controls/OrbitControls';

    const scene = new THREE.Scene();
    scene.background = new THREE.Color('#111');

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 10);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // 光源
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
    directionalLight.position.set(5, 10, 7.5);
    scene.add(directionalLight);

    // 筊杯模型
    const cups = [];
    const cupGeometry = new THREE.SphereGeometry(1, 32, 32, 0, Math.PI, 0, Math.PI/1.5);
    const cupMaterial1 = new THREE.MeshStandardMaterial({ color: 0xdd3333 });
    const cupMaterial2 = new THREE.MeshStandardMaterial({ color: 0xdd3333 });
    const cup1 = new THREE.Mesh(cupGeometry, cupMaterial1);
    const cup2 = new THREE.Mesh(cupGeometry, cupMaterial2);
    cup1.rotation.x = Math.PI / 2;
    cup2.rotation.x = Math.PI / 2;
    cup1.position.x = -2;
    cup2.position.x = 2;
    scene.add(cup1);
    scene.add(cup2);
    cups.push(cup1, cup2);

    // 地面
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(20, 20),
      new THREE.MeshStandardMaterial({ color: 0x333333 })
    );
    ground.rotation.x = -Math.PI / 2;
    ground.position.y = -1.1;
    scene.add(ground);

    // 擲筊動畫
    function throwCups() {
      cups.forEach((cup, i) => {
        const targetRot = new THREE.Vector3(
          Math.random() * 6,
          Math.random() * 6,
          Math.random() * 6
        );
        const start = Date.now();
        const duration = 1000;

        function animate() {
          const t = (Date.now() - start) / duration;
          if (t < 1) {
            cup.rotation.x = targetRot.x * t;
            cup.rotation.y = targetRot.y * t;
            cup.rotation.z = targetRot.z * t;
            requestAnimationFrame(animate);
          }
        }
        animate();
      });

      navigator.vibrate?.(200);
    }

    // 主要動畫迴圈
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
