const cat = document.getElementById('cat');
const sfx = document.getElementById('sfx');
const resultText = document.getElementById('resultText');
sfx.volume = 0.8;

const results = [
  { file: '8-3.JPG', weight: 0.5 },
  { file: '8-1.JPG', weight: 0.25 },
  { file: '8-2.JPG', weight: 0.25 }
];

const resultTextMap = {
  '8-3.JPG': 'あたり！',
  '8-2.JPG': 'はずれ！',
  '8-1.JPG': 'わからん〜'
};

results.forEach(r => {
  const img = new Image(); img.src = r.file;
});

function getResult() {
  let r = Math.random(), sum = 0;
  for (const item of results) {
    sum += item.weight;
    if (r < sum) return item.file;
  }
  return results[results.length - 1].file;
}

let isPlaying = false;

cat.addEventListener('click', () => {
  if (isPlaying) return;
  isPlaying = true;
  resultText.style.display = 'none';

  cat.src = 'cat.gif';

  setTimeout(() => {
    sfx.currentTime = 0;
    sfx.play().catch(err => console.warn('Audio play failed:', err));
  }, 1060);

  setTimeout(() => {
    const resultFile = getResult();
    cat.src = resultFile;

    resultText.innerText = resultTextMap[resultFile] || '';
    resultText.style.display = 'block';

    if (navigator.vibrate) navigator.vibrate(200);
    isPlaying = false;
  }, 4060);
});
